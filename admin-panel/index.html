<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Raman Vada Pav</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #e23744; --secondary: #ff9f43; --light: #f9f9f9;
            --dark: #333; --gray: #777; --success: #27ae60; --info: #2980b9;
            --danger: #c0392b; --bg-light: #f4f7f9; --border-color: #e8e8e8;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body { background-color: var(--bg-light); display: flex; height: 100vh; overflow: hidden; }

        /* --- Login --- */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-light); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-box { background: white; padding: 40px; border-radius: 12px; text-align: center; width: 90%; max-width: 360px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .login-box h3 { color: var(--primary); font-size: 1.8rem; margin-bottom: 20px; }
        .login-box input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: 600; font-size: 1rem; transition: all 0.2s ease; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn-primary { background-color: var(--primary); }
        
        /* --- Layout --- */
        .sidebar { width: 250px; background: white; display: flex; flex-direction: column; height: 100vh; position: fixed; z-index: 100; box-shadow: 2px 0 10px rgba(0,0,0,0.05); transition: transform 0.3s ease-in-out; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid var(--border-color); }
        .sidebar-header h2 { color: var(--primary); }
        .sidebar-nav { list-style: none; padding: 10px 0; }
        .nav-item a { display: flex; align-items: center; gap: 15px; padding: 15px 20px; color: var(--dark); text-decoration: none; border-left: 4px solid transparent; transition: all 0.3s; }
        .nav-item a:hover, .nav-item a.active { background: #ffeef0; color: var(--primary); border-left-color: var(--primary); font-weight: 600; }
        .nav-item a i { width: 20px; text-align: center; }

        .main-container { flex-grow: 1; margin-left: 250px; display: none; flex-direction: column; height: 100vh; }
        .main-header { background: white; padding: 15px 25px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 50; }
        #menu-toggle { display: none; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--dark); margin-right: 15px; }
        #page-title { font-size: 1.5rem; font-weight: 600; color: var(--dark); }

        .main-content { flex-grow: 1; padding: 25px; overflow-y: auto; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 25px; }
        .card-header { font-size: 1.3rem; font-weight: 600; color: var(--dark); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        
        /* --- Dashboard --- */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; border: 1px solid var(--border-color); text-align: center;}
        .stat-card i { font-size: 1.8rem; color: var(--primary); margin-bottom: 10px; }
        .stat-card h3 { font-size: 2rem; color: var(--dark); }
        .stat-card p { color: var(--gray); }

        /* --- Forms --- */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #fdfdfd; }
        .btn-success { background-color: var(--success); }
        .btn-secondary { background-color: var(--gray); }
        .btn-danger { background-color: var(--danger); }

        /* --- Status Tags --- */
        .status-tag { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; color: white; text-transform: uppercase; }
        .status-placed { background-color: var(--info); }
        .status-accepted { background-color: var(--secondary); }
        .status-preparing { background-color: #e67e22; }
        .status-on-its-way { background-color: #8e44ad; }
        .status-delivered { background-color: var(--success); }
        .status-instock { background-color: var(--success); }
        .status-outofstock { background-color: var(--danger); }
        
        .empty-state { text-align: center; padding: 40px; }
        .empty-state i { font-size: 3rem; color: #ccc; margin-bottom: 15px; }
        .empty-state p { font-size: 1.1rem; color: var(--gray); }

        #mobile-menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 99; display: none; }
        
        /* --- Mobile Responsive --- */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); z-index: 1001; }
            .sidebar.active { transform: translateX(0); }
            .main-container { margin-left: 0; }
            #menu-toggle { display: block; }
            .main-content, .main-header { padding: 15px; }
            .card { padding: 15px; }
            #page-title, .card-header { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div id="login-overlay"><div class="login-box"><h3>Admin Login</h3><div class="form-group"><input type="text" id="username" placeholder="Username" value="admin"></div><div class="form-group"><input type="password" id="password" placeholder="Password" value="password"></div><button class="btn btn-primary" onclick="handleLogin()">Login</button></div></div>
    
    <div id="mobile-menu-overlay" onclick="toggleMenu()"></div>

    <aside class="sidebar" id="sidebar" style="display:none;">
        <div class="sidebar-header"><h2>Raman Vada Pav</h2></div>
        <ul class="sidebar-nav">
            <li class="nav-item"><a href="#" data-page="dashboard" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
            <li class="nav-item"><a href="#" data-page="orders"><i class="fas fa-receipt"></i> Orders</a></li>
            <li class="nav-item"><a href="#" data-page="menu"><i class="fas fa-utensils"></i> Menu</a></li>
            <li class="nav-item"><a href="#" data-page="shop"><i class="fas fa-store"></i> Shop Settings</a></li>
            <li class="nav-item"><a href="#" onclick="handleLogout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </aside>

    <div class="main-container">
        <header class="main-header">
            <button id="menu-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
            <h1 id="page-title">Dashboard</h1>
        </header>
        <main class="main-content">
            <section id="dashboard" class="page active"></section>
            <section id="orders" class="page"></section>
            <section id="menu" class="page"></section>
            <section id="shop" class="page"></section>
        </main>
    </div>

    <!-- ========= START: FIREBASE INTEGRATION ========= -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
      const firebaseConfig = {
          apiKey: "AIzaSyD1QEf2wmpnNH6JMeDQpKoExWlaJzM4VYs",
          authDomain: "my-shope-raman.firebaseapp.com",
          databaseURL: "https://my-shope-raman-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "my-shope-raman",
          storageBucket: "my-shope-raman.appspot.com",
          messagingSenderId: "1058019322311",
          appId: "1:1058019322311:web:240c7eeba4be628bc911e2"
      };
      
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
    </script>
    <!-- ========= END: FIREBASE INTEGRATION ========= -->

    <!-- ========= START: NEW JAVASCRIPT LOGIC ========= -->
    <script>
        // --- Global Variables ---
        let allMenuItems = [];
        let allOrders = [];
        let shopInfo = {};

        // --- Auth & App Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('isAdminLoggedIn') === 'true') {
                initApp();
            }
        });

        const handleLogin = () => {
            if (document.getElementById('username').value === 'admin' && document.getElementById('password').value === 'password') {
                sessionStorage.setItem('isAdminLoggedIn', 'true');
                initApp();
            } else {
                alert('Invalid credentials');
            }
        };

        const handleLogout = () => {
            sessionStorage.removeItem('isAdminLoggedIn');
            location.reload();
        };

        const initApp = () => {
            document.getElementById('login-overlay').style.display = 'none';
            document.querySelector('.sidebar').style.display = 'flex';
            document.querySelector('.main-container').style.display = 'flex';
            
            setupFirebaseListeners();
            renderPageStructure();

            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                if (link.dataset.page) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        showPage(link.dataset.page);
                    });
                }
            });
        };

        // --- Firebase Real-time Data Listeners ---
        function setupFirebaseListeners() {
            database.ref('menuItems').on('value', snapshot => {
                const data = snapshot.val();
                allMenuItems = data ? Object.values(data).filter(item => item) : [];
                // Check if the page is active before re-rendering
                if (document.getElementById('menu').classList.contains('active')) renderMenu();
                if (document.getElementById('dashboard').classList.contains('active')) renderDashboard();
            });

            database.ref('orders').on('value', snapshot => {
                const data = snapshot.val();
                allOrders = data ? Object.values(data).sort((a, b) => b.id.localeCompare(a.id)) : [];
                if (document.getElementById('orders').classList.contains('active')) renderOrders();
                if (document.getElementById('dashboard').classList.contains('active')) renderDashboard();
            });

            database.ref('shopInfo').on('value', snapshot => {
                shopInfo = snapshot.val() || {};
                if (document.getElementById('shop').classList.contains('active')) renderShopSettingsPage();
            });
        }

        // --- UI & Navigation ---
        const toggleMenu = () => {
            document.getElementById('sidebar').classList.toggle('active');
            const overlay = document.getElementById('mobile-menu-overlay');
            overlay.style.display = (overlay.style.display === 'block') ? 'none' : 'block';
        };

        const showPage = (pageId) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.toggle('active', a.dataset.page === pageId));
            
            const pageName = document.querySelector(`.sidebar-nav a[data-page="${pageId}"]`).textContent;
            document.getElementById('page-title').textContent = pageName;
            
            if (window.innerWidth <= 768 && document.getElementById('sidebar').classList.contains('active')) {
                toggleMenu();
            }
            // Render content when page is shown
            switch(pageId) {
                case 'dashboard': renderDashboard(); break;
                case 'orders': renderOrders(); break;
                case 'menu': renderMenuPage(); break;
                case 'shop': renderShopSettingsPage(); break;
            }
        };

        // --- Render Functions (To build the HTML for each section) ---
        const renderPageStructure = () => { // Call this only once
            document.getElementById('dashboard').innerHTML = `<div class="stats-grid"></div>`;
            document.getElementById('orders').innerHTML = `<div class="card"><div class="card-header">New Orders</div><div id="new-order-list"></div></div><div class="card"><div class="card-header">Active & Past Orders</div><div id="active-order-list"></div></div>`;
            document.getElementById('menu').innerHTML = `<div class="card"><div class="card-header">Add / Edit Menu Item</div><form id="menu-item-form"></form></div><div class="card"><div class="card-header">Current Menu</div><div id="menu-list" class="stats-grid"></div></div>`;
            document.getElementById('shop').innerHTML = `<div class="card"><div class="card-header">Shop Information</div><form id="shop-info-form"></form></div><div class="card"><div class="card-header">Opening Hours</div><form id="opening-hours-form"></form><button class="btn btn-primary" onclick="saveOpeningHours()" style="margin-top:15px;">Save Hours</button></div>`;
            showPage('dashboard');
        };

        const renderDashboard = () => {
            const newOrdersCount = allOrders.filter(o => o.status === 0).length;
            const outOfStockCount = allMenuItems.filter(item => !item.available).length;
            document.querySelector('#dashboard .stats-grid').innerHTML = `
                <div class="stat-card"><i class="fas fa-receipt"></i><h3>${newOrdersCount}</h3><p>New Orders</p></div>
                <div class="stat-card"><i class="fas fa-utensils"></i><h3>${allMenuItems.length}</h3><p>Total Menu Items</p></div>
                <div class="stat-card"><i class="fas fa-box-open"></i><h3>${outOfStockCount}</h3><p>Items Out of Stock</p></div>`;
        };

        const renderOrders = () => {
            const statuses = ["Placed", "Accepted", "Preparing", "On its way", "Delivered"];
            const statusClasses = ["placed", "accepted", "preparing", "on-its-way", "delivered"];
            const newOrders = allOrders.filter(o => o.status === 0);
            const otherOrders = allOrders.filter(o => o.status > 0);

            const createOrderCard = (order) => {
                return `<div class="card" style="margin-bottom:15px; border-left: 5px solid var(--primary);">
                    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border-color); padding-bottom:10px; margin-bottom:10px;">
                        <div><b>#${order.id.slice(-6)}</b> | ${order.customerName || 'Guest'}</div>
                        <span class="status-tag status-${statusClasses[order.status]}">${statuses[order.status]}</span>
                    </div>
                    ${order.items.map(item => `
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                            <img src="${item.image || ''}" style="width:40px; height:40px; border-radius:8px; object-fit:cover;">
                            <span>${item.quantity} x ${item.name}</span>
                        </div>`).join('')}
                    <div class="form-group" style="margin-top:15px; margin-bottom:0;">
                        <select onchange="updateOrderStatus('${order.id}', this.value)" style="padding:8px; border-radius:8px; border:1px solid var(--border-color);">
                        ${statuses.map((s, i) => `<option value="${i}" ${order.status === i ? 'selected' : ''}>${s}</option>`).join('')}</select>
                    </div></div>`;
            };

            const emptyState = (msg) => `<div class="empty-state"><i class="fas fa-inbox"></i><p>${msg}</p></div>`;
            document.getElementById('new-order-list').innerHTML = newOrders.length ? newOrders.map(createOrderCard).join('') : emptyState('No new orders.');
            document.getElementById('active-order-list').innerHTML = otherOrders.length ? otherOrders.map(createOrderCard).join('') : emptyState('No active or past orders.');
        };
        
        const renderMenuPage = () => {
            document.getElementById('menu-item-form').innerHTML = `
                <input type="hidden" id="menu-item-id">
                <div class="form-group"><label>Name</label><input type="text" id="item-name" required></div>
                <div class="form-group"><label>Description</label><textarea id="item-desc" rows="2" required></textarea></div>
                <div class="form-group"><label>Price (₹)</label><input type="number" id="item-price" required></div>
                <div class="form-group"><label>Image URL</label><input type="url" id="item-image" required></div>
                <div class="form-group"><label>Availability</label><select id="item-available"><option value="true">In Stock</option><option value="false">Out of Stock</option></select></div>
                <button type="submit" class="btn btn-success">Save Item</button> <button type="button" class="btn btn-secondary" onclick="clearMenuForm()">Cancel</button>`;
            renderMenu();
            document.getElementById('menu-item-form').addEventListener('submit', saveMenuItem);
        };
        
        const renderMenu = () => {
            document.getElementById('menu-list').innerHTML = allMenuItems.length ? allMenuItems.map(item => `
                <div class="card">
                    <img src="${item.image}" alt="${item.name}" style="width:100%; height:160px; object-fit:cover; border-radius:8px; margin-bottom:10px;">
                    <h4>${item.name}</h4><p style="font-size:0.9rem; color:var(--gray);">${item.desc}</p>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                        <b style="color:var(--primary);">₹${item.price}</b>
                        <span class="status-tag ${item.available ? 'status-instock' : 'status-outofstock'}">${item.available ? 'In Stock' : 'Out of Stock'}</span>
                    </div>
                    <div style="margin-top:15px; display:flex; gap:10px;">
                        <button class="btn btn-secondary" style="flex:1; padding:8px;" onclick="editMenuItem(${item.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger" style="flex:1; padding:8px;" onclick="deleteMenuItem(${item.id})"><i class="fas fa-trash"></i></button>
                    </div></div>`).join('') : `<div class="empty-state"><i class="fas fa-utensils"></i><p>No menu items found. Add one!</p></div>`;
        };

        const renderShopSettingsPage = () => {
            document.getElementById('shop-info-form').innerHTML = `
                <div class="form-group"><label>Shop Name</label><input type="text" id="shop-name" value="${shopInfo.name || ''}" required></div>
                <div class="form-group"><label>Slogan</label><input type="text" id="shop-slogan" value="${shopInfo.slogan || ''}"></div>
                <div class="form-group"><label>Header Logo (Circle)</label><input type="url" id="shop-logo-circle" value="${shopInfo.logoCircle || ''}"></div>
                <div class="form-group"><label>Shop Banner (16:9)</label><input type="url" id="shop-banner" value="${shopInfo.banner || ''}"></div>
                <div class="form-group"><label>Display Address</label><textarea id="shop-address" rows="2" required>${shopInfo.address || ''}</textarea></div>
                <div class="form-group"><label>Google Maps URL</label><input type="url" id="shop-map-url" value="${shopInfo.mapUrl || ''}"></div>
                <button type="submit" class="btn btn-primary">Save Shop Info</button>`;
            renderOpeningHoursForm();
            document.getElementById('shop-info-form').addEventListener('submit', saveShopInfo);
        };
        
        const renderOpeningHoursForm = () => {
            const hoursContainer = document.getElementById('opening-hours-form');
            const days = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
            hoursContainer.innerHTML = days.map(day => {
                const dayInfo = (shopInfo.openingHours && shopInfo.openingHours[day]) ? shopInfo.openingHours[day] : { open: '08:00', close: '22:00', closed: false };
                return `
                <div class="form-group" style="display:flex; align-items:center; gap:10px; flex-wrap: wrap;">
                    <label style="flex-basis:100px; text-transform:capitalize;">${day}</label>
                    <input type="time" style="flex:1;" id="${day}-open" value="${dayInfo.open}" ${dayInfo.closed ? 'disabled' : ''}>
                    <input type="time" style="flex:1;" id="${day}-close" value="${dayInfo.close}" ${dayInfo.closed ? 'disabled' : ''}>
                    <label style="display:flex; align-items:center; gap:5px;"><input type="checkbox" id="${day}-closed" onchange="toggleDay('${day}', this.checked)" ${dayInfo.closed ? 'checked' : ''}> Closed</label>
                </div>`
            }).join('');
        };
        
        // --- Logic Functions (Writing Data to Firebase) ---
        const updateOrderStatus = (id, status) => database.ref('orders/' + id + '/status').set(parseInt(status));
        
        const saveMenuItem = (e) => {
            e.preventDefault();
            const id = document.getElementById('menu-item-id').value;
            const itemId = id ? parseInt(id) : Date.now();
            const itemData = {
                id: itemId, name: document.getElementById('item-name').value,
                desc: document.getElementById('item-desc').value, price: parseFloat(document.getElementById('item-price').value),
                image: document.getElementById('item-image').value, available: document.getElementById('item-available').value === 'true'
            };
            database.ref('menuItems/' + itemId).set(itemData).then(() => clearMenuForm());
        };
        
        const deleteMenuItem = (id) => {
            if (confirm('Are you sure you want to delete this item?')) {
                database.ref('menuItems/' + id).remove();
            }
        };

        const clearMenuForm = () => {
            document.getElementById('menu-item-form').reset();
            document.getElementById('menu-item-id').value = '';
        };

        const editMenuItem = (id) => {
            const item = allMenuItems.find(x => x.id === id);
            if (item) {
                document.getElementById('menu-item-id').value = item.id;
                document.getElementById('item-name').value = item.name;
                document.getElementById('item-desc').value = item.desc;
                document.getElementById('item-price').value = item.price;
                document.getElementById('item-image').value = item.image;
                document.getElementById('item-available').value = item.available.toString();
                showPage('menu');
                document.querySelector('#menu .card').scrollIntoView();
            }
        };

        const saveShopInfo = (e) => {
            e.preventDefault();
            const info = {
                name: document.getElementById('shop-name').value, slogan: document.getElementById('shop-slogan').value,
                logoCircle: document.getElementById('shop-logo-circle').value, banner: document.getElementById('shop-banner').value,
                address: document.getElementById('shop-address').value, mapUrl: document.getElementById('shop-map-url').value
            };
            database.ref('shopInfo').update(info).then(() => alert('Shop info saved!'));
        };

        const saveOpeningHours = () => {
            const hours = {};
            const days = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
            days.forEach(day => {
                hours[day] = {
                    open: document.getElementById(`${day}-open`).value,
                    close: document.getElementById(`${day}-close`).value,
                    closed: document.getElementById(`${day}-closed`).checked
                }
            });
            database.ref('shopInfo/openingHours').set(hours).then(() => alert('Opening hours saved!'));
        };

        const toggleDay = (day, isClosed) => {
            document.getElementById(`${day}-open`).disabled = isClosed;
            document.getElementById(`${day}-close`).disabled = isClosed;
        };

    </script>
</body>
</html>
